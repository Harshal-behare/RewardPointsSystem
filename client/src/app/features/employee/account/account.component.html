<div class="employee-account">
  <!-- Page Header -->
  <div class="page-header">
    <h1 class="page-title"> My Account</h1>
    <p class="page-subtitle">View your points and redemption history</p>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading()" class="loading-container">
    <div class="spinner"></div>
    <p>Loading your account data...</p>
  </div>

  <!-- Summary Cards -->
  <div *ngIf="!isLoading()" class="summary-section">
    <div class="summary-card earned">
      <div class="summary-icon"></div>
      <div class="summary-info">
        <span class="summary-label">Total Earned</span>
        <span class="summary-value">{{ totalEarned() }}</span>
      </div>
    </div>

    <div class="summary-card balance">
      <div class="summary-icon"></div>
      <div class="summary-info">
        <span class="summary-label">Current Balance</span>
        <span class="summary-value">{{ currentBalance() }}</span>
      </div>
    </div>

    <div class="summary-card redeemed">
      <div class="summary-icon"></div>
      <div class="summary-info">
        <span class="summary-label">Total Redeemed</span>
        <span class="summary-value">{{ totalRedeemed() }}</span>
      </div>
    </div>
  </div>

  <!-- Tabs -->
  <div *ngIf="!isLoading()" class="tabs-container">
    <div class="tabs-header">
      <button
        class="tab-btn"
        [class.active]="activeTab === 'points'"
        (click)="switchTab('points')"
      >
         Points History
      </button>
      <button
        class="tab-btn"
        [class.active]="activeTab === 'redemptions'"
        (click)="switchTab('redemptions')"
      >
         Redemption History
      </button>
    </div>

    <!-- Points History Tab -->
    <div *ngIf="activeTab === 'points'" class="tab-content">
      <!-- Empty State for Points -->
      <div *ngIf="pointsHistory().length === 0" class="empty-state">
        <span class="empty-icon"></span>
        <h3>No transactions yet</h3>
        <p>Your points transactions will appear here once you earn or redeem points.</p>
      </div>

      <div *ngIf="pointsHistory().length > 0" class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Description</th>
              <th>Source</th>
              <th>Event/Rank</th>
              <th>Points</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let transaction of pointsHistory()">
              <td>{{ transaction.date }}</td>
              <td>
                <div class="transaction-cell">
                  <span class="transaction-icon">{{ getTransactionIcon(transaction.type) }}</span>
                  <span>{{ transaction.description }}</span>
                </div>
              </td>
              <td>
                <span class="source-badge" [ngClass]="'source-' + (transaction.source?.toLowerCase() || 'direct')">
                  {{ transaction.source || 'Direct' }}
                </span>
              </td>
              <td>
                <div *ngIf="transaction.eventName" class="event-info">
                  <span class="event-badge">{{ transaction.eventName }}</span>
                  <span *ngIf="transaction.rank" class="rank-badge">🏆 Rank #{{ transaction.rank }}</span>
                </div>
                <span *ngIf="!transaction.eventName" class="text-muted">-</span>
              </td>
              <td>
                <span
                  class="points-value"
                  [class.positive]="transaction.points > 0"
                  [class.negative]="transaction.points < 0"
                >
                  {{ transaction.points > 0 ? '+' : '' }}{{ transaction.points }}
                </span>
              </td>
              <td>
                <span class="status-badge" [ngClass]="getStatusClass(transaction.status)">
                  {{ transaction.status }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Redemption History Tab -->
    <div *ngIf="activeTab === 'redemptions'" class="tab-content">
      <!-- Empty State for Redemptions -->
      <div *ngIf="redemptionHistory().length === 0" class="empty-state">
        <span class="empty-icon"></span>
        <h3>No redemptions yet</h3>
        <p>Your product redemptions will appear here once you redeem your points.</p>
      </div>

      <div *ngIf="redemptionHistory().length > 0" class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Product</th>
              <th>Qty</th>
              <th>Points</th>
              <th>Status</th>
              <th>Notes</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let redemption of redemptionHistory()">
              <td>{{ redemption.date }}</td>
              <td>
                <span class="product-name">{{ redemption.productName }}</span>
              </td>
              <td>{{ redemption.quantity }}</td>
              <td>
                <span class="points-value negative">-{{ redemption.points }}</span>
              </td>
              <td>
                <span class="status-badge" [ngClass]="getStatusClass(redemption.status)">
                  {{ redemption.status | titlecase }}
                </span>
              </td>
              <td>
                <span *ngIf="redemption.trackingNumber" class="tracking-number">
                  {{ redemption.trackingNumber }}
                </span>
                <span *ngIf="redemption.rejectionReason" class="rejection-reason">
                  {{ redemption.rejectionReason }}
                </span>
                <span *ngIf="!redemption.trackingNumber && !redemption.rejectionReason" class="text-muted">-</span>
              </td>
              <td>
                <button 
                  *ngIf="redemption.status === 'pending'"
                  class="cancel-btn"
                  (click)="cancelRedemption(redemption)"
                >
                  Cancel
                </button>
                <span *ngIf="redemption.status !== 'pending'" class="text-muted">-</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
