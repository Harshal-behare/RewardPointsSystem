<div class="employee-products">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">üéÅ Products Catalog</h1>
      <p class="page-subtitle">Redeem your points for amazing rewards</p>
    </div>
    <div class="user-points">
      <span class="points-label">Your Points:</span>
      <span class="points-value">{{ userPoints() }}</span>
    </div>
  </div>

  <!-- Filters & Search -->
  <div class="filters-section">
    <div class="category-tabs">
      <button
        *ngFor="let category of categories"
        class="category-tab"
        [class.active]="selectedCategory() === category.value"
        (click)="onCategoryChange(category.value)"
      >
        {{ category.label }}
      </button>
    </div>

    <div class="search-box">
      <input
        type="text"
        placeholder="Search products..."
        [ngModel]="searchQuery()"
        (ngModelChange)="onSearchChange($event)"
        class="search-input"
      />
      <span class="search-icon">üîç</span>
    </div>
  </div>

  <!-- Products Grid -->
  <div class="products-grid">
    <div *ngFor="let product of filteredProducts()" class="product-card">
      <div class="product-image-container">
        <img [src]="product.image" [alt]="product.name" class="product-image" />
        <span *ngIf="product.featured" class="featured-badge">‚≠ê Featured</span>
        <span *ngIf="isOutOfStock(product)" class="stock-badge out-of-stock">Out of Stock</span>
        <span *ngIf="isLowStock(product)" class="stock-badge low-stock">Only {{ product.stock }} left</span>
      </div>

      <div class="product-content">
        <span class="product-category">{{ product.category }}</span>
        <h3 class="product-title">{{ product.name }}</h3>
        <p class="product-description">{{ product.description }}</p>

        <div class="product-footer">
          <div class="product-info">
            <span class="product-points">{{ product.points }} pts</span>
            <span class="product-stock">Stock: {{ product.stock }}</span>
          </div>

          <button
            class="redeem-btn"
            [disabled]="!canRedeem(product)"
            (click)="openRedeemModal(product)"
          >
            {{ isOutOfStock(product) ? 'Out of Stock' : (userPoints() >= product.points ? 'Redeem Now' : 'Insufficient Points') }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="filteredProducts().length === 0" class="empty-state">
    <span class="empty-icon">üîç</span>
    <h3>No products found</h3>
    <p>Try adjusting your filters or search query</p>
  </div>
</div>

<!-- Redeem Modal -->
<div *ngIf="showRedeemModal() && selectedProduct()" class="modal-overlay" (click)="closeRedeemModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">Redeem Product</h2>
      <button class="close-btn" (click)="closeRedeemModal()">‚úï</button>
    </div>

    <div class="modal-body">
      <div class="product-summary">
        <img [src]="selectedProduct()!.image" [alt]="selectedProduct()!.name" class="summary-image" />
        <div class="summary-details">
          <h3 class="summary-title">{{ selectedProduct()!.name }}</h3>
          <p class="summary-category">{{ selectedProduct()!.category }}</p>
          <p class="summary-points">{{ selectedProduct()!.points }} points each</p>
          <p class="summary-stock">{{ selectedProduct()!.stock }} in stock</p>
        </div>
      </div>

      <!-- Validation Errors -->
      <div class="error-list" *ngIf="redemptionValidationErrors().length > 0">
        <div class="error" *ngFor="let error of redemptionValidationErrors()">{{ error }}</div>
      </div>

      <div class="form-group">
        <label class="form-label">Quantity *</label>
        <input
          type="number"
          [ngModel]="redemptionQuantity()"
          (ngModelChange)="redemptionQuantity.set($event)"
          min="1"
          max="10"
          class="form-input"
        />
        <small class="form-hint">Max 10 items per redemption</small>
      </div>

      <div class="points-summary">
        <div class="summary-row">
          <span>Current Points:</span>
          <span class="current-points">{{ userPoints() }}</span>
        </div>
        <div class="summary-row">
          <span>Product Cost ({{ redemptionQuantity() }} x {{ selectedProduct()!.points }}):</span>
          <span class="product-cost">-{{ selectedProduct()!.points * redemptionQuantity() }}</span>
        </div>
        <div class="summary-row total">
          <span>Remaining Points:</span>
          <span class="remaining-points">{{ userPoints() - (selectedProduct()!.points * redemptionQuantity()) }}</span>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="modal-btn cancel-btn" (click)="closeRedeemModal()">Cancel</button>
      <button
        class="modal-btn confirm-btn"
        [disabled]="userPoints() < (selectedProduct()!.points * redemptionQuantity()) || redemptionQuantity() < 1 || redemptionQuantity() > 10 || redemptionQuantity() > selectedProduct()!.stock"
        (click)="confirmRedeem()"
      >
        Confirm Redemption
      </button>
    </div>
  </div>
</div>
