<div class="employee-products">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title"><app-icon name="gift" [size]="28"></app-icon> Products Catalog</h1>
      <p class="page-subtitle">Redeem your points for amazing rewards</p>
    </div>
    <div class="user-points">
      <span class="points-label">Your Points:</span>
      <span class="points-value">{{ userPoints() }}</span>
    </div>
  </div>

  <!-- Filters & Search -->
  <div class="filters-section">
    <div class="category-tabs">
      @for (category of categories(); track category.value) {
        <button
          class="category-tab"
          [class.active]="selectedCategory() === category.value"
          (click)="onCategoryChange(category.value)"
        >
          {{ category.label }}
        </button>
      }
    </div>

    <div class="search-box">
      <input
        type="text"
        placeholder="Search products..."
        [ngModel]="searchQuery()"
        (ngModelChange)="onSearchChange($event)"
        class="search-input"
      />
      <span class="search-icon"><app-icon name="search" [size]="18"></app-icon></span>
    </div>
  </div>

  <!-- Products Grid -->
  <div class="products-grid">
    @for (product of filteredProducts(); track product.id) {
      <div class="product-card">
        <div class="product-image-container">
          <img [src]="product.image" [alt]="product.name" class="product-image" />
          @if (product.featured) {
            <span class="featured-badge"><app-icon name="star" [size]="14"></app-icon> Featured</span>
          }
          @if (isOutOfStock(product)) {
            <span class="stock-badge out-of-stock">Out of Stock</span>
          }
          @if (isLowStock(product) && !isOutOfStock(product)) {
            <span class="stock-badge low-stock">Only {{ product.stock }} left</span>
          }
          @if (hasPendingRedemption(product)) {
            <span class="stock-badge pending"><app-icon name="pending" [size]="14"></app-icon> Pending Request</span>
          }
        </div>

        <div class="product-content">
          <span class="product-category">{{ product.category }}</span>
          <h3 class="product-title">{{ product.name }}</h3>
          <p class="product-description">{{ product.description }}</p>

          <div class="product-footer">
            <div class="product-info">
              <span class="product-points">{{ product.points }} pts</span>
              <span class="product-stock">Stock: {{ product.stock }}</span>
            </div>

            <button
              class="redeem-btn"
              [disabled]="!canRedeem(product)"
              (click)="openRedeemModal(product)"
            >
              {{ isOutOfStock(product) ? 'Out of Stock' : 
                 (hasPendingRedemption(product) ? 'Pending Request' : 
                 (userPoints() >= product.points ? 'Redeem Now' : 'Insufficient Points')) }}
            </button>
          </div>
        </div>
      </div>
    }
  </div>

  <!-- Empty State -->
  @if (filteredProducts().length === 0) {
    <div class="empty-state">
      <span class="empty-icon"><app-icon name="search" [size]="48"></app-icon></span>
      <h3>No products found</h3>
      <p>Try adjusting your filters or search query</p>
    </div>
  }
</div>

<!-- Redeem Modal -->
@if (showRedeemModal() && selectedProduct()) {
  <div class="modal-overlay" (click)="closeRedeemModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">Redeem Product</h2>
      </div>

      <div class="modal-body">
        <div class="product-summary">
          <img [src]="selectedProduct()!.image" [alt]="selectedProduct()!.name" class="summary-image" />
          <div class="summary-details">
            <h3 class="summary-title">{{ selectedProduct()!.name }}</h3>
            <p class="summary-category">{{ selectedProduct()!.category }}</p>
            <p class="summary-points">{{ selectedProduct()!.points }} points each</p>
            <p class="summary-stock">{{ selectedProduct()!.stock }} in stock</p>
          </div>
        </div>

        <!-- Validation Errors -->
        @if (redemptionValidationErrors().length > 0) {
          <div class="error-list">
            @for (error of redemptionValidationErrors(); track error) {
              <div class="error">{{ error }}</div>
            }
          </div>
        }

        <div class="form-group">
          <label class="form-label">Quantity *</label>
          <input
            type="number"
            [ngModel]="redemptionQuantity()"
            (ngModelChange)="redemptionQuantity.set($event)"
            min="1"
            max="10"
            class="form-input"
          />
          <small class="form-hint">Max 10 items per redemption</small>
        </div>

        <div class="points-summary">
          <div class="summary-row">
            <span>Current Points:</span>
            <span class="current-points">{{ userPoints() }}</span>
          </div>
          <div class="summary-row">
            <span>Product Cost ({{ redemptionQuantity() }} x {{ selectedProduct()!.points }}):</span>
            <span class="product-cost">-{{ selectedProduct()!.points * redemptionQuantity() }}</span>
          </div>
          <div class="summary-row total">
            <span>Remaining Points:</span>
            <span class="remaining-points">{{ userPoints() - (selectedProduct()!.points * redemptionQuantity()) }}</span>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="modal-btn cancel-btn" (click)="closeRedeemModal()">Cancel</button>
        <button
          class="modal-btn confirm-btn"
          [disabled]="userPoints() < (selectedProduct()!.points * redemptionQuantity()) || redemptionQuantity() < 1 || redemptionQuantity() > 10 || redemptionQuantity() > selectedProduct()!.stock"
          (click)="confirmRedeem()"
        >
          Confirm Redemption
        </button>
      </div>
    </div>
  </div>
}
