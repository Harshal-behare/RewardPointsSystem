<div class="employee-events">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">ğŸ‰ Events</h1>
      <p class="page-subtitle">Discover and register for exciting company events</p>
    </div>
  </div>

  <!-- Filters & Search -->
  <div class="filters-section">
    <div class="filter-tabs">
      <button
        class="filter-tab"
        [class.active]="selectedFilter() === 'all'"
        (click)="onFilterChange('all')"
      >
        All Events
      </button>
      <button
        class="filter-tab"
        [class.active]="selectedFilter() === 'Upcoming'"
        (click)="onFilterChange('Upcoming')"
      >
        Upcoming
      </button>
      <button
        class="filter-tab"
        [class.active]="selectedFilter() === 'Completed'"
        (click)="onFilterChange('Completed')"
      >
        Completed
      </button>
    </div>

    <div class="search-box">
      <input
        type="text"
        placeholder="Search events..."
        [ngModel]="searchQuery()"
        (ngModelChange)="searchQuery.set($event); onSearchChange()"
        class="search-input"
      />
      <span class="search-icon">ğŸ”</span>
    </div>
  </div>

  <!-- Events Grid -->
  <div class="events-grid">
    @for (event of filteredEvents(); track event.id) {
    <div class="event-card">
      <div class="event-image-container">
        <img [src]="event.imageUrl || 'https://images.unsplash.com/photo-1540575467063-178a50c2df87?w=600'" [alt]="event.name" class="event-image" />
        <span class="event-badge" [ngClass]="getStatusBadgeClass(event.status)">
          {{ getStatusLabel(event.status) }}
        </span>
      </div>

      <div class="event-content">
        <h3 class="event-title">{{ event.name }}</h3>
        <p class="event-description">{{ event.description }}</p>

        <div class="event-meta">
          <div class="meta-item">
            <span class="meta-icon">ğŸ“…</span>
            <span class="meta-text">{{ event.eventDate | date:'mediumDate' }}</span>
          </div>
          @if (event.maxParticipants) {
          <div class="meta-item">
            <span class="meta-icon">ğŸ‘¥</span>
            <span class="meta-text">
              {{ event.participantCount }} / {{ event.maxParticipants }} participants
            </span>
          </div>
          }
        </div>

        <!-- Availability Bar -->
        @if (event.maxParticipants) {
        <div class="availability-bar">
          <div
            class="availability-fill"
            [style.width.%]="getAvailabilityPercentage(event)"
            [class.full]="isEventFull(event)"
          ></div>
        </div>
        }

        <div class="event-footer">
          <span class="event-points">+{{ event.pointsPool }} points</span>

          <div class="event-actions">
            <button class="action-btn details-btn" (click)="openDetailsModal(event)">
              View Details
            </button>

            <!-- Show Register button if NOT registered and event is Upcoming -->
            @if (!event.registered && event.status === 'Upcoming') {
            <button
              class="action-btn register-btn"
              [disabled]="isEventFull(event)"
              (click)="registerForEvent(event)"
            >
              {{ isEventFull(event) ? 'Event Full' : 'Register' }}
            </button>
            }

            <!-- Show Registered badge if registered (cannot unregister once registered) -->
            @if (event.registered) {
            <span class="registered-badge">
              âœ“ Registered
            </span>
            }
          </div>
        </div>
      </div>
    </div>
    }
  </div>

  <!-- Empty State -->
  @if (filteredEvents().length === 0) {
  <div class="empty-state">
    <span class="empty-icon">ğŸ”</span>
    <h3>No events found</h3>
    <p>Try adjusting your filters or search query</p>
  </div>
  }
</div>

<!-- Event Details Modal -->
@if (showDetailsModal() && selectedEvent()) {
<div class="modal-overlay" (click)="closeDetailsModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">{{ selectedEvent()!.name }}</h2>
      <button class="close-btn" (click)="closeDetailsModal()">âœ•</button>
    </div>

    <div class="modal-body">
      <img [src]="selectedEvent()!.imageUrl || 'https://images.unsplash.com/photo-1540575467063-178a50c2df87?w=600'" [alt]="selectedEvent()!.name" class="modal-event-image" />

      <div class="modal-event-info">
        <div class="info-section">
          <h3 class="info-title">Description</h3>
          <p class="info-text">{{ selectedEvent()!.description }}</p>
        </div>

        <div class="info-section">
          <h3 class="info-title">Event Details</h3>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">ğŸ“… Date:</span>
              <span class="info-value">{{ selectedEvent()!.eventDate | date:'fullDate' }}</span>
            </div>
            @if (selectedEvent()!.maxParticipants) {
            <div class="info-item">
              <span class="info-label">ğŸ‘¥ Participants:</span>
              <span class="info-value">
                {{ selectedEvent()!.participantCount }} / {{ selectedEvent()!.maxParticipants }}
              </span>
            </div>
            }
            <div class="info-item">
              <span class="info-label">ğŸ† Reward:</span>
              <span class="info-value">{{ selectedEvent()!.pointsPool }} points</span>
            </div>
          </div>
        </div>

        <div class="info-section">
          <div class="status-badge-large" [ngClass]="getStatusBadgeClass(selectedEvent()!.status)">
            Status: {{ getStatusLabel(selectedEvent()!.status) }}
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="modal-btn cancel-btn" (click)="closeDetailsModal()">Close</button>

      @if (!selectedEvent()!.registered && selectedEvent()!.status === 'Upcoming') {
      <button
        class="modal-btn register-btn"
        [disabled]="isEventFull(selectedEvent()!)"
        (click)="registerForEvent(selectedEvent()!); closeDetailsModal()"
      >
        {{ isEventFull(selectedEvent()!) ? 'Event Full' : 'Register Now' }}
      </button>
      }

      @if (selectedEvent()!.registered) {
      <span class="registered-badge modal-registered">
        âœ“ Already Registered
      </span>
      }
    </div>
  </div>
</div>
}
