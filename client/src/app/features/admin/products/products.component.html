<div class="products-container">
  <!-- Quick Actions -->
  <div class="quick-actions-bar">
    <button class="quick-action-btn primary" (click)="openCreateModal()">
      <span class="action-icon">‚ûï</span>
      <span>Add New Product</span>
    </button>
    <button class="quick-action-btn secondary" (click)="refreshData()">
      <span class="action-icon">üîÑ</span>
      <span>Refresh</span>
    </button>
  </div>

  <app-card>
    <!-- Header -->
    <div header class="products-header">
      <div>
        <h2>Products Management</h2>
        <p class="subtitle">Manage product catalog and inventory</p>
      </div>
      <div class="header-actions">
        <button class="view-toggle" (click)="toggleViewMode()">
          {{ viewMode() === 'grid' ? 'üìã Table View' : 'üî≤ Grid View' }}
        </button>
        <app-button (clicked)="openCreateModal()">
          ‚ûï Add Product
        </app-button>
      </div>
    </div>

    <!-- Filters & Search -->
    <div class="filters-section">
      <div class="filter-tabs">
        <button
          class="filter-tab"
          [class.active]="selectedCategory() === 'all'"
          (click)="onCategoryChange('all')">
          All Products
        </button>
        <button
          *ngFor="let category of categories().slice(1)"
          class="filter-tab"
          [class.active]="selectedCategory() === category"
          (click)="onCategoryChange(category)">
          {{ category }}
        </button>
      </div>

      <div class="search-box">
        <input
          type="text"
          placeholder="Search products..."
          [ngModel]="searchQuery()"
          (ngModelChange)="searchQuery.set($event); onSearchChange()"
          class="search-input"
        />
        <span class="search-icon">üîç</span>
      </div>
    </div>

    <!-- Grid View -->
    <div *ngIf="viewMode() === 'grid'" class="products-grid">
      <div class="product-card" *ngFor="let product of filteredProducts()">
        <div class="product-image">
          <img [src]="product.imageUrl" [alt]="product.name" />
          <app-badge 
            [variant]="getStatusVariant(product.status)" 
            class="status-badge"
          >
            {{ product.status }}
          </app-badge>
        </div>
        <div class="product-info">
          <span class="product-category">{{ product.category }}</span>
          <h3 class="product-name">{{ product.name }}</h3>
          <p class="product-description">{{ product.description }}</p>
          <div class="product-footer">
            <div class="product-price">
              <span class="points-label">Points:</span>
              <span class="points-value">{{ product.pointsPrice }}</span>
            </div>
            <div class="product-stock">
              <app-badge [variant]="getStockStatus(product.stock).variant" size="sm">
                {{ getStockStatus(product.stock).label }}
              </app-badge>
              <span class="stock-count">{{ product.stock }} units</span>
            </div>
          </div>
          <div class="product-actions">
            <app-button size="sm" variant="secondary" (clicked)="openEditModal(product)">
              ‚úèÔ∏è Edit
            </app-button>
            <button class="delete-icon-btn" (click)="deleteProduct(product.id)" title="Delete">
              üóëÔ∏è
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Table View -->
    <div *ngIf="viewMode() === 'table'" class="table-container">
      <table class="products-table">
        <thead>
          <tr>
            <th>Product</th>
            <th>Category</th>
            <th>Points Price</th>
            <th>Stock</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let product of filteredProducts()">
            <td>
              <div class="table-product">
                <img [src]="product.imageUrl" [alt]="product.name" class="table-product-image" />
                <div>
                  <strong>{{ product.name }}</strong>
                  <span class="table-description">{{ product.description }}</span>
                </div>
              </div>
            </td>
            <td>{{ product.category }}</td>
            <td>
              <span class="points-value">{{ product.pointsPrice }} pts</span>
            </td>
            <td>
              <div class="stock-info">
                <app-badge [variant]="getStockStatus(product.stock).variant" size="sm">
                  {{ product.stock }} units
                </app-badge>
              </div>
            </td>
            <td>
              <app-badge [variant]="getStatusVariant(product.status)">
                {{ product.status }}
              </app-badge>
            </td>
            <td>
              <div class="action-buttons">
                <button class="action-btn edit-btn" (click)="openEditModal(product)" title="Edit">
                  ‚úèÔ∏è
                </button>
                <button class="action-btn delete-btn" (click)="deleteProduct(product.id)" title="Delete">
                  üóëÔ∏è
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </app-card>
</div>

<!-- Product Modal -->
<div class="modal-overlay" *ngIf="showModal()" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>{{ modalMode() === 'create' ? 'Add New Product' : 'Edit Product' }}</h3>
      <button class="close-btn" (click)="closeModal()">‚úï</button>
    </div>

    <div class="modal-body">
      <form>
        <div class="form-group">
          <label for="productName">Product Name *</label>
          <input
            id="productName"
            type="text"
            [(ngModel)]="selectedProduct.name"
            name="name"
            placeholder="Enter product name"
            required
          />
        </div>

        <div class="form-group">
          <label for="productDescription">Description</label>
          <textarea
            id="productDescription"
            [(ngModel)]="selectedProduct.description"
            name="description"
            placeholder="Enter product description"
            rows="3"
          ></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="category">Category *</label>
            <select
              id="category"
              [(ngModel)]="selectedProduct.categoryId"
              name="categoryId"
              required
            >
              <option value="">Select a category</option>
              <option *ngFor="let cat of dbCategories()" [value]="cat.id">{{ cat.name }}</option>
            </select>
          </div>

          <div class="form-group">
            <label for="pointsPrice">Points Price *</label>
            <input
              id="pointsPrice"
              type="number"
              [(ngModel)]="selectedProduct.pointsPrice"
              name="pointsPrice"
              placeholder="0"
              required
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="stock">Stock Quantity *</label>
            <input
              id="stock"
              type="number"
              [(ngModel)]="selectedProduct.stock"
              name="stock"
              placeholder="0"
              required
            />
          </div>

          <div class="form-group">
            <label for="status">Status *</label>
            <select
              id="status"
              [(ngModel)]="selectedProduct.status"
              name="status"
              required
            >
              <option value="Active">Active</option>
              <option value="Inactive">Inactive</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="imageUrl">Image URL</label>
          <input
            id="imageUrl"
            type="text"
            [(ngModel)]="selectedProduct.imageUrl"
            name="imageUrl"
            placeholder="https://example.com/image.jpg"
          />
        </div>
      </form>
    </div>

    <div class="modal-footer">
      <app-button variant="secondary" (clicked)="closeModal()">
        Cancel
      </app-button>
      <app-button (clicked)="saveProduct()">
        {{ modalMode() === 'create' ? 'Add Product' : 'Save Changes' }}
      </app-button>
    </div>
  </div>
</div>
