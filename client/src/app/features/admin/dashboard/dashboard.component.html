<div class="dashboard-container">
  <!-- Page Header -->
  <div class="page-header">
    <h1>Admin Dashboard</h1>
    <p class="subtitle">System overview and quick actions</p>
  </div>

  <!-- Section 1: System Overview (5 KPI Cards) -->
  <section class="kpi-section">
    @for (kpi of kpiData(); track kpi.label) {
      <app-kpi-card
        [icon]="kpi.icon"
        [label]="kpi.label"
        [value]="kpi.value"
        [trend]="kpi.trend"
        (click)="navigateToPage(kpi.route)"
        style="cursor: pointer;"
        title="Click to view {{ kpi.label }}"
      ></app-kpi-card>
    }
  </section>

  <!-- Two Column Layout for Sections 2 & 3 -->
  <div class="grid-2-col">
    <!-- Section 2: Redemption Actions (Most Important) -->
    <app-card title="Redemption Actions" class="redemption-actions-card">
      <div class="stat-boxes">
        <div class="stat-box pending" (click)="navigateToPage('/admin/redemptions')" style="cursor: pointer;">
          <div class="stat-icon">⏳</div>
          <div class="stat-content">
            <div class="stat-label">Pending</div>
            <div class="stat-value">{{ redemptionSummary().pending }}</div>
          </div>
        </div>

        <div class="stat-box approved">
          <div class="stat-icon">✓</div>
          <div class="stat-content">
            <div class="stat-label">Approved Today</div>
            <div class="stat-value">{{ redemptionSummary().approved }}</div>
          </div>
        </div>

        <div class="stat-box rejected">
          <div class="stat-icon">✕</div>
          <div class="stat-content">
            <div class="stat-label">Rejected Today</div>
            <div class="stat-value">{{ redemptionSummary().rejected }}</div>
          </div>
        </div>
      </div>

      @if (redemptionSummary().pending > 0) {
        <div class="action-footer">
          <button class="btn-link" (click)="navigateToPage('/admin/redemptions')">
            <app-icon name="arrow-right" [size]="14"></app-icon> View All Redemptions
          </button>
        </div>
      }
    </app-card>

    <!-- Section 3: Event Status Summary -->
    <app-card title="Event Status Summary">
      <div class="event-status-grid">
        <div class="status-item">
          <app-badge variant="secondary">{{ eventStatusSummary().draft }}</app-badge>
          <span class="status-label">Draft</span>
        </div>
        <div class="status-item">
          <app-badge variant="info">{{ eventStatusSummary().upcoming }}</app-badge>
          <span class="status-label">Upcoming</span>
        </div>
        <div class="status-item">
          <app-badge variant="success">{{ eventStatusSummary().active }}</app-badge>
          <span class="status-label">Active</span>
        </div>
        <div class="status-item">
          <app-badge variant="secondary">{{ eventStatusSummary().completed }}</app-badge>
          <span class="status-label">Completed</span>
        </div>
      </div>
    </app-card>
  </div>

  <!-- Two Column Layout for Sections 4 & 5 -->
  <div class="grid-2-col">
    <!-- Section 4: Events Needing Attention -->
    <app-card title="Events Needing Attention">
      @if (eventsNeedingAttention().length > 0) {
        <div class="events-attention-list">
          @for (event of eventsNeedingAttention(); track event.id) {
            <div class="event-item" (click)="navigateToPage('/admin/events')" style="cursor: pointer;">
              <div class="event-info">
                <div class="event-name">{{ event.name }}</div>
                <div class="event-meta">
                  @if (event.status === 'Active') {
                    <app-badge variant="success" size="sm">Active Now</app-badge>
                  }
                  @if (event.status === 'Completed' && event.remainingPoints === event.totalPointsPool) {
                    <app-badge variant="warning" size="sm">Assign Winners</app-badge>
                  }
                  @if (event.status === 'Upcoming') {
                    <app-badge variant="info" size="sm">Starting Soon</app-badge>
                  }
                </div>
              </div>
              <app-icon name="chevron-right" [size]="16"></app-icon>
            </div>
          }
        </div>
      } @else {
        <div class="empty-state">
          <app-icon name="check-circle" [size]="40"></app-icon>
          <p>No events need attention</p>
        </div>
      }
    </app-card>

    <!-- Section 5: Inventory Snapshot -->
    <app-card title="Inventory Alerts">
      @if (inventoryAlerts().length > 0) {
        <div class="inventory-alerts-list">
          @for (alert of inventoryAlerts(); track alert.productId) {
            <div class="inventory-alert-item">
              <div class="alert-icon" [class.critical]="alert.alertType === 'Out of Stock'">
                <app-icon name="warning" [size]="18"></app-icon>
              </div>
              <div class="alert-content">
                <div class="alert-product">{{ alert.productName }}</div>
                <div class="alert-status">
                  @if (alert.alertType === 'Out of Stock') {
                    <app-badge variant="danger" size="sm">Out of Stock</app-badge>
                  } @else {
                    <app-badge variant="warning" size="sm">Low Stock ({{ alert.currentStock }})</app-badge>
                  }
                </div>
              </div>
            </div>
          }
        </div>
      } @else {
        <div class="empty-state">
          <app-icon name="check-circle" [size]="40"></app-icon>
          <p>All products in stock</p>
        </div>
      }
    </app-card>
  </div>

  <!-- Section 6: Points Summary -->
  <app-card title="Points Summary" class="points-summary-card">
    <div class="points-grid">
      <div class="points-stat">
        <div class="points-icon issued">
          <app-icon name="trending-up" [size]="24"></app-icon>
        </div>
        <div class="points-content">
          <div class="points-label">Total Issued</div>
          <div class="points-value">{{ formatNumber(pointsSummary().totalPointsDistributed) }}</div>
        </div>
      </div>

      <div class="points-stat">
        <div class="points-icon redeemed">
          <app-icon name="trending-down" [size]="24"></app-icon>
        </div>
        <div class="points-content">
          <div class="points-label">Total Redeemed</div>
          <div class="points-value">{{ formatNumber(pointsSummary().totalPointsRedeemed) }}</div>
        </div>
      </div>

      <div class="points-stat">
        <div class="points-icon circulation">
          <app-icon name="refresh" [size]="24"></app-icon>
        </div>
        <div class="points-content">
          <div class="points-label">In Circulation</div>
          <div class="points-value">{{ formatNumber(pointsSummary().totalPointsInCirculation) }}</div>
        </div>
      </div>

      <div class="points-stat">
        <div class="points-icon pending">
          <app-icon name="clock" [size]="24"></app-icon>
        </div>
        <div class="points-content">
          <div class="points-label">Pending</div>
          <div class="points-value">{{ formatNumber(pointsSummary().pendingPoints) }}</div>
        </div>
      </div>
    </div>
  </app-card>

  <!-- Charts Section -->
  <div class="grid-2-col charts-section">
    <app-card title="Redemption Status Distribution" class="chart-card">
      <div class="chart-container">
        <apx-chart
          [series]="redemptionChartOptions().series"
          [chart]="redemptionChartOptions().chart"
          [labels]="redemptionChartOptions().labels"
          [colors]="redemptionChartOptions().colors"
          [legend]="redemptionChartOptions().legend"
          [responsive]="redemptionChartOptions().responsive"
        ></apx-chart>
      </div>
    </app-card>

    <app-card title="Event Status Distribution" class="chart-card">
      <div class="chart-container">
        <apx-chart
          [series]="eventChartOptions().series"
          [chart]="eventChartOptions().chart"
          [labels]="eventChartOptions().labels"
          [colors]="eventChartOptions().colors"
          [legend]="eventChartOptions().legend"
          [responsive]="eventChartOptions().responsive"
        ></apx-chart>
      </div>
    </app-card>
  </div>

  <!-- Quick Actions Section -->
  <app-card title="Quick Actions" class="quick-actions-card">
    <div class="quick-actions-grid">
      <button class="quick-action-btn event-btn" (click)="openEventModal()">
        <span class="action-icon"><app-icon name="calendar" [size]="20"></app-icon></span>
        <div class="action-content">
          <h3>Create Event</h3>
          <p>Add a new reward event</p>
        </div>
      </button>

      <button class="quick-action-btn product-btn" (click)="openProductModal()">
        <span class="action-icon"><app-icon name="gift" [size]="20"></app-icon></span>
        <div class="action-content">
          <h3>Add Product</h3>
          <p>Add new product to catalog</p>
        </div>
      </button>

      <button class="quick-action-btn users-btn" (click)="navigateToPage('/admin/users')">
        <span class="action-icon"><app-icon name="users" [size]="20"></app-icon></span>
        <div class="action-content">
          <h3>Manage Users</h3>
          <p>View and manage users</p>
        </div>
      </button>

      <button class="quick-action-btn redemptions-btn" (click)="navigateToPage('/admin/redemptions')">
        <span class="action-icon"><app-icon name="cart" [size]="20"></app-icon></span>
        <div class="action-content">
          <h3>Redemptions</h3>
          <p>Process pending redemptions</p>
        </div>
      </button>
    </div>
  </app-card>
</div>

<!-- Create Event Modal -->
@if (showEventModal()) {
  <div class="modal-overlay" (click)="closeEventModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3><app-icon name="events" [size]="20"></app-icon> Create New Event</h3>
        <button class="close-btn" (click)="closeEventModal()"><app-icon name="close" [size]="18"></app-icon></button>
      </div>

    <div class="modal-body">
      <form>
        <div class="form-group">
          <label for="eventName">Event Name *</label>
          <input
            id="eventName"
            type="text"
            [(ngModel)]="newEvent.name"
            name="name"
            placeholder="Enter event name"
            required
          />
        </div>

        <div class="form-group">
          <label for="eventDescription">Description</label>
          <textarea
            id="eventDescription"
            [(ngModel)]="newEvent.description"
            name="description"
            placeholder="Enter event description"
            rows="3"
          ></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="eventDate">Event Date *</label>
            <input
              id="eventDate"
              type="date"
              [(ngModel)]="newEvent.eventDate"
              name="eventDate"
              required
            />
          </div>

          <div class="form-group">
            <label for="pointsPool">Points Pool *</label>
            <input
              id="pointsPool"
              type="number"
              [(ngModel)]="newEvent.pointsPool"
              name="pointsPool"
              placeholder="0"
              required
            />
          </div>
        </div>
      </form>
    </div>

    <div class="modal-footer">
      <app-button variant="secondary" (clicked)="closeEventModal()">
        Cancel
      </app-button>
      <app-button (clicked)="createEvent()">
        Create Event
      </app-button>
    </div>
    </div>
  </div>
}

<!-- Create Product Modal -->
@if (showProductModal()) {
  <div class="modal-overlay" (click)="closeProductModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3><app-icon name="gift" [size]="20"></app-icon> Add New Product</h3>
        <button class="close-btn" (click)="closeProductModal()"><app-icon name="close" [size]="18"></app-icon></button>
      </div>

    <div class="modal-body">
      <form>
        <div class="form-group">
          <label for="productName">Product Name *</label>
          <input
            id="productName"
            type="text"
            [(ngModel)]="newProduct.name"
            name="name"
            placeholder="Enter product name"
            required
          />
        </div>

        <div class="form-group">
          <label for="productDescription">Description</label>
          <textarea
            id="productDescription"
            [(ngModel)]="newProduct.description"
            name="description"
            placeholder="Enter product description"
            rows="3"
          ></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="productCategory">Category *</label>
            <select
              id="productCategory"
              [(ngModel)]="newProduct.category"
              name="category"
              required
            >
              <option value="Electronics">Electronics</option>
              <option value="Appliances">Appliances</option>
              <option value="Wearables">Wearables</option>
              <option value="Office">Office</option>
              <option value="Accessories">Accessories</option>
            </select>
          </div>

          <div class="form-group">
            <label for="pointsPrice">Points Price *</label>
            <input
              id="pointsPrice"
              type="number"
              [(ngModel)]="newProduct.pointsPrice"
              name="pointsPrice"
              placeholder="0"
              required
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="stock">Stock Quantity *</label>
            <input
              id="stock"
              type="number"
              [(ngModel)]="newProduct.stock"
              name="stock"
              placeholder="0"
              required
            />
          </div>

          <div class="form-group">
            <label for="imageUrl">Image URL</label>
            <input
              id="imageUrl"
              type="text"
              [(ngModel)]="newProduct.imageUrl"
              name="imageUrl"
              placeholder="https://..."
            />
          </div>
        </div>
      </form>
    </div>

    <div class="modal-footer">
      <app-button variant="secondary" (clicked)="closeProductModal()">
        Cancel
      </app-button>
      <app-button (clicked)="createProduct()">
        Add Product
      </app-button>
    </div>
    </div>
  </div>
}
