<div class="login-page">
  <div class="login-card">
    <img
      src="assets/Agdata_logo.png"
      alt="AGDATA Logo"
      style="height: 80px; width: 250px"
      class="brand-logo"
    />

    <div class="login-box">
      <form [formGroup]="form" (ngSubmit)="onSubmit()">
        <h2>Login</h2>

        <div class="form-group">
          <label for="email">Email</label>
          <input id="email" type="email" formControlName="email" placeholder="" maxlength="255" autocomplete="email" />

          @if (form.get('email')?.invalid && form.get('email')?.dirty) {
            <div class="error">
              @if (form.get('email')?.errors?.['required']) {
                <span>Email is required</span>
              } @else if (form.get('email')?.errors?.['email']) {
                <span>Invalid email format</span>
              } @else if (form.get('email')?.errors?.['maxlength']) {
                <span>Email cannot exceed 255 characters</span>
              } @else if (form.get('email')?.errors?.['agdataEmail']) {
                <span>Only @agdata.com email can login</span>
              }
            </div>
          }
        </div>

        <div class="form-group">
          <label for="password">Password</label>

          <div class="password-wrapper">
            <input
              id="password"
              [type]="showPassword ? 'text' : 'password'"
              formControlName="password"
              placeholder=""
              autocomplete="current-password"
            />

            <button
              type="button"
              class="toggle-password"
              (mouseenter)="showPassword = true"
              (mouseleave)="showPassword = false"
              (focus)="showPassword = true"
              (blur)="showPassword = false"
              [attr.aria-label]="showPassword ? 'Hide password' : 'Show password'"
            >
              <app-icon [name]="showPassword ? 'eye-off' : 'eye'" [size]="18" class="password-icon"></app-icon>
            </button>
          </div>

          @let pwd = form.get('password');
          @if (pwd?.invalid && pwd?.dirty) {
            <div class="error">
              @if (pwd?.errors?.['required']) {
                <span>Password is required</span>
              } @else if (pwd?.errors?.['minlength']) {
                <span>Password must be at least 8 characters</span>
              } @else if (pwd?.errors?.['maxlength']) {
                <span>Password cannot exceed 20 characters</span>
              } @else if (pwd?.errors?.['pattern']) {
                <span>Password must include uppercase, lowercase, number, and special character</span>
              }
            </div>
          }
          <small class="form-hint">Requirement: 8-20 chars, uppercase, lowercase, number, special char</small>
        </div>

        <!-- Show all validation errors from backend -->
        @if (validationErrors().length > 0) {
          <div class="error-list">
            @for (error of validationErrors(); track error) {
              <div class="error">{{ error }}</div>
            }
          </div>
        }

        <!-- Fallback single error message -->
        @if (errorMsg() && validationErrors().length === 0) {
          <div class="error">{{ errorMsg() }}</div>
        }

        <button class="login-btn" type="submit"
                [disabled]="loading() || form.invalid"
                [class.disabled]="form.invalid">
          {{ loading() ? 'Signing in...' : 'Login' }}
        </button>

        <!-- <a class="forgot-link" href="#">Forgot password?</a> -->
      </form>
    </div>

    <div class="footer-links">
      <!-- <a href="#">About</a>
      <a href="#">Privacy Policy</a> -->
    </div>
  </div>
</div>
